name: 'Python Tests'
description: 'Run pytest with coverage'
author: 'provide.io llc'

inputs:
  test-directory:
    description: 'Test directory'
    required: false
    default: 'tests/'
  coverage-threshold:
    description: 'Coverage threshold percentage'
    required: false
    default: '80'
  parallel:
    description: 'Run tests in parallel'
    required: false
    default: 'true'

runs:
  using: 'composite'
  steps:
    - name: ðŸ“¥ Checkout ci-tooling
      uses: actions/checkout@v4
      with:
        repository: provide-io/ci-tooling
        ref: main
        path: .ci-tooling

    - name: ðŸ§ª Run Tests
      shell: bash
      run: |
        echo "ðŸ§ª Running pytest on: ${{ inputs.test-directory }}"
        PYTEST_ARGS="${{ inputs.test-directory }} --cov --cov-report=xml --cov-report=term -v --cov-fail-under=${{ inputs.coverage-threshold }}"
        if [ "${{ inputs.parallel }}" = "true" ]; then
          PYTEST_ARGS="$PYTEST_ARGS -n auto"
        fi
        .venv/bin/pytest $PYTEST_ARGS

branding:
  icon: 'check-square'
  color: 'blue'

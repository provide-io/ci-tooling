# wrknv.toml - Python project task runner configuration
# Generated from: ci-tooling/templates/wrknv-python.toml.jinja
# Canonical source: ci-tooling/tasks/python/ci.toml
#
# Usage:
#   we run ci          # Full CI pipeline (quality + test + security)
#   we run quality     # Code quality checks only
#   we run test        # Run tests only
#   we run lint.fix    # Fix linting issues
#   we run format      # Format code

[tasks]
typecheck = "mypy src/"
build = "uv build"

[tasks.lint]
_default = "ruff check ."
fix = "ruff check . --fix"

[tasks.format]
_default = "ruff format ."
check = "ruff format . --check"

[tasks.security]
_default = "bandit -r src/ -c pyproject.toml"

[tasks.test]
_default = "pytest"
parallel = "pytest -n auto"
verbose = "pytest -vvv"
unit = "pytest -m unit"
integration = "pytest -m integration"

[tasks.test.coverage]
_default = "pytest --cov={{ package_name | default('src') }} --cov-report=html --cov-report=term-missing"
xml = "pytest --cov={{ package_name | default('src') }} --cov-report=xml --cov-report=term"

[tasks.quality]
_default = ["lint", "format.check", "typecheck"]

[tasks.ci]
_default = ["quality", "test", "security"]
quality = ["format.check", "lint", "typecheck"]
test = ["test.parallel", "test.coverage"]

[tasks.pkg]
install = "uv pip install -e ."
lock = "uv lock"
version = "cat VERSION 2>/dev/null || grep '^version = ' pyproject.toml | cut -d'\"' -f2"

[tasks.clean]
run = """
rm -rf build/ dist/ *.egg-info .pytest_cache .mypy_cache .ruff_cache htmlcov/ .coverage site/
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
find . -type f -name '*.pyc' -delete 2>/dev/null || true
"""

[tasks.setup]
_default = "uv sync --all-groups"
{% if has_docs %}

# Documentation tasks (optional - remove if not using mkdocs)
[tasks.docs]
_default = "python .provide/foundry/scripts/docs_serve.py"
setup = "python -c \"from provide.foundry.config import extract_base_mkdocs; from pathlib import Path; extract_base_mkdocs(Path('.'))\""
build = "python .provide/foundry/scripts/docs_preflight.py && mkdocs build"
clean = "rm -rf site .provide"

[tasks.docs.serve]
run = "python .provide/foundry/scripts/docs_serve.py"
timeout = 604800.0

[tasks.docs.links]
_default = "lychee --offline --verbose --no-progress './docs/**/*.md' './src/**/*.md' './README.md'"
{% endif %}

# ─────────────────────────────────────────────────────────────────────────────
# Project-specific overrides below this line
# ─────────────────────────────────────────────────────────────────────────────
